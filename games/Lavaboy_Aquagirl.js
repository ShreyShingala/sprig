const player1 = "p";
const player2 = "a";
const box1 = "b";
const box2 = "e";
const goal1 = "g";
const goal2 = "f";
const wall = "w";
const acid = "t";
const water = "l";
const fire = "r";

setLegend(
  [ player1, bitmap`
................
................
................
................
...555555555....
...5......55....
...5.0..0..5....
...5..00...5....
...5.......5....
...555555555....
.......5........
.....5555.......
.......5........
......555.......
.....55.5.......
................`],
  [ player2, bitmap`
................
................
......33........
.....33333......
..333333333.....
.....33333333...
.....3......33..
.....33.0.0..3..
......33.0...3..
.......333333...
.........3......
.3333333333333..
.........3......
........33......
.......33.3.....
......33..3.....`],
  [ box1, bitmap`
................
................
................
...77777777777..
...7....7....7..
...7....7....7..
...7....7....7..
...7....7....7..
...77777777777..
...7....7....7..
...7....7....7..
...7....7....7..
...7....7....7..
...77777777777..
................
................`],
  [ box2, bitmap`
................
................
................
...33333333333..
...3....3....3..
...3....3....3..
...3....3....3..
...3....3....3..
...33333333333..
...3....3....3..
...3....3....3..
...3....3....3..
...3....3....3..
...33333333333..
................
................`],
  [ goal1, bitmap`
................
................
................
....777777......
...77....77.....
...7......7.....
...7.......7....
...7.......7....
...7.......7....
...77......7....
....7......7....
....77....77....
.....777777.....
................
................
................`],
  [ goal2, bitmap`
................
................
........3333333.
.......3......3.
.....33.......3.
....3.........3.
...33.........3.
...33........33.
.....3......33..
......3....33...
.......3333.....
................
................
................
................
................`],
  [ acid, bitmap`
................
................
................
...........4....
...........4....
..4........4....
..4....44444....
...44...4..4....
.....444.444....
.......4..4.4...
..........444...
.........44..4..
......444....44.
....44........4.
..............4.
.............4..`],
  [ water, bitmap`
................
................
................
................
................
.....5....55....
...555..5555....
...555..555.....
...555..555.....
...555..555.....
...555..555.....
....55....5.....
5555555555555555
5555555555555555
5555555555555555
5555555555555555`],
  [ fire, bitmap`
................
.........3......
......3.33.3....
.....3333333....
....33.33333....
....3..33.33....
....333.66.3....
......3666.3....
......36.663....
......36..63....
.....366..633...
....336...6.3...
..........66....
................
................
................`],
  [ wall, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`]
);

let level = 0; 
const levels = [
  map`
t.....
...a..
.....e
....p.
...b.g
.....f`,
  map`
tfea
..b.
.p.g`,
  map`
.t..
fe..
ep.b
..ab
.bbg`,
  map`
.t..
fe..
ep.b
..ab
.bbg`,
  map`
t.g...r......
..f...r......
......r...b..
.a....r...f..
......r......
......r......
lllllllllllll
.............
.............
...........p.
.............`,
  map`
wwwt
fpwa
.bwg
..e.
..bg`
];


const currentLevel = levels[level];
setMap(currentLevel);

setSolids([ player1, box1, wall, box2, player2]); 

setPushables({
  [player1]: [box1],
  [box1]: [box1],
  [box1]: [box2],
  [box2]: [box1],
  [player2]: [box2]
});


onInput("w", () => {
  getFirst(player1).y -= 1; // positive y is downwards
});

onInput("a", () => {
  getFirst(player1).x -= 1; // positive y is downwards
});

onInput("s", () => {
  getFirst(player1).y += 1; // positive y is downwards
});

onInput("d", () => {
  getFirst(player1).x += 1;
});

onInput("i", () => {
  getFirst(player2).y -= 1; // positive y is downwards
});

onInput("j", () => {
  getFirst(player2).x -= 1; // positive y is downwards
});

onInput("k", () => {
  getFirst(player2).y += 1; // positive y is downwards
});

onInput("l", () => {
  getFirst(player2).x += 1;
});




afterInput(() => {

  const targetNumber = tilesWith(goal1).length + tilesWith(goal2).length;
  

  const numberCovered = tilesWith(goal1, box1).length + tilesWith(goal2, box2).length;

  const waterdead = tilesWith(player1, fire).length;
  const firedead = tilesWith(player2, water).length;
  const bothdead = tilesWith(player1, acid).length + tilesWith(player2, acid).length;
  
  if (waterdead === 1){
    setMap(currentLevel);}
  if (firedead === 1){
    setMap(currentLevel);}
  if (bothdead === 1 || bothdead === 2){
    setMap(currentLevel);}
  
  
  if (numberCovered === targetNumber) {
   
    level = level + 1;

    const currentLevel = levels[level];

   
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("You are the best team!", { y: 4, color: color`3` });
    }
  }
});
